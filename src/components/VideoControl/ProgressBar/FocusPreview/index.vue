<template>
  <div class="focus-preview">
    <svg viewBox="0 0 1000 100" preserveAspectRatio="none" width="100%" height="100%">
      <defs>
        <!-- 曲线剪切 -->
        <clipPath id="pbp-curve-path">
          <path :d='getCurvePath()'></path>
        </clipPath>

        <!-- 已播放区域剪切 -->
        <clipPath id="pbp-played-path">
          <rect x="0" width="30%" y="0" height="100%"></rect>
          <rect x="45%" width="30%" y="0" height="100%"></rect>
        </clipPath>
      </defs>
      <g fill-opacity="0.2" clip-path="url(#pbp-curve-path)">
        <rect x="0" y="0" width="100%" height="100%" fill="rgb(255,255,255)"></rect>
        <rect x="0" y="0" width="100%" height="100%" fill="rgb(35,173,229)" clip-path="url(#pbp-played-path)"></rect>
      </g>
    </svg>
  </div>
</template>

<script>
  import { value } from '../../../../mock/focus-preview.js'

  export default {
    name: 'FocusPreview',
    data () {
      return {
        curveData: value
      }
    },
    methods: {

      // 获取曲线剪切路径
      getCurvePath () {
        const min = Math.min(...this.curveData), max = Math.max(...this.curveData)
        const a = 80 / (min - max), b = 80 - (min * 80) / (min - max) // y = ax + b , 过 (min , 80) (max , 0) 两点，求 a , b
        let re = 'M 0 100 '
        for (let i = 0; i < 100; i++) {
          if (i === 0) {
            re += `L 0 ${a * 0 + b} `
          } else {
            re += `C ${5 * 2 * i - 5} ${a * this.curveData[(i - 1)] + b}, ${5 * 2 * i - 5} ${a * this.curveData[i] + b}, ${5 * 2 * i} ${a * this.curveData[i] + b} `
          }
        }
        re += 'L 1000 100 Z'
        // 'M 0 100 L 0 80 C 5.0 80.0, 5.0 75.5, 10.0 75.5 C 15.0 75.5, 15.0 73.0, 20.0 73.0 C 25.0 73.0, 25.0 70.9, 30.0 70.9 C 35.0 70.9, 35.0 69.3, 40.0 69.3 C 45.0 69.3, 45.0 66.2, 50.0 66.2 C 55.0 66.2, 55.0 57.3, 60.0 57.3 C 65.0 57.3, 65.0 15.8, 70.0 15.8 C 75.0 15.8, 75.0 67.6, 80.0 67.6 C 85.0 67.6, 85.0 64.0, 90.0 64.0 C 95.0 64.0, 95.0 67.0, 100.0 67.0 C 105.0 67.0, 105.0 68.1, 110.0 68.1 C 115.0 68.1, 115.0 74.5, 120.0 74.5 C 125.0 74.5, 125.0 70.4, 130.0 70.4 C 135.0 70.4, 135.0 64.9, 140.0 64.9 C 145.0 64.9, 145.0 66.5, 150.0 66.5 C 155.0 66.5, 155.0 64.7, 160.0 64.7 C 165.0 64.7, 165.0 67.4, 170.0 67.4 C 175.0 67.4, 175.0 68.6, 180.0 68.6 C 185.0 68.6, 185.0 74.5, 190.0 74.5 C 195.0 74.5, 195.0 74.2, 200.0 74.2 C 205.0 74.2, 205.0 72.4, 210.0 72.4 C 215.0 72.4, 215.0 56.6, 220.0 56.6 C 225.0 56.6, 225.0 65.7, 230.0 65.7 C 235.0 65.7, 235.0 74.2, 240.0 74.2 C 245.0 74.2, 245.0 72.7, 250.0 72.7 C 255.0 72.7, 255.0 71.0, 260.0 71.0 C 265.0 71.0, 265.0 62.3, 270.0 62.3 C 275.0 62.3, 275.0 67.5, 280.0 67.5 C 285.0 67.5, 285.0 66.5, 290.0 66.5 C 295.0 66.5, 295.0 67.3, 300.0 67.3 C 305.0 67.3, 305.0 69.9, 310.0 69.9 C 315.0 69.9, 315.0 75.2, 320.0 75.2 C 325.0 75.2, 325.0 68.3, 330.0 68.3 C 335.0 68.3, 335.0 66.9, 340.0 66.9 C 345.0 66.9, 345.0 57.5, 350.0 57.5 C 355.0 57.5, 355.0 73.0, 360.0 73.0 C 365.0 73.0, 365.0 44.7, 370.0 44.7 C 375.0 44.7, 375.0 66.9, 380.0 66.9 C 385.0 66.9, 385.0 68.5, 390.0 68.5 C 395.0 68.5, 395.0 69.8, 400.0 69.8 C 405.0 69.8, 405.0 70.5, 410.0 70.5 C 415.0 70.5, 415.0 67.6, 420.0 67.6 C 425.0 67.6, 425.0 68.6, 430.0 68.6 C 435.0 68.6, 435.0 64.1, 440.0 64.1 C 445.0 64.1, 445.0 66.5, 450.0 66.5 C 455.0 66.5, 455.0 36.4, 460.0 36.4 C 465.0 36.4, 465.0 62.0, 470.0 62.0 C 475.0 62.0, 475.0 66.7, 480.0 66.7 C 485.0 66.7, 485.0 63.4, 490.0 63.4 C 495.0 63.4, 495.0 64.3, 500.0 64.3 C 505.0 64.3, 505.0 73.6, 510.0 73.6 C 515.0 73.6, 515.0 73.5, 520.0 73.5 C 525.0 73.5, 525.0 67.7, 530.0 67.7 C 535.0 67.7, 535.0 70.4, 540.0 70.4 C 545.0 70.4, 545.0 75.4, 550.0 75.4 C 555.0 75.4, 555.0 74.8, 560.0 74.8 C 565.0 74.8, 565.0 68.3, 570.0 68.3 C 575.0 68.3, 575.0 75.3, 580.0 75.3 C 585.0 75.3, 585.0 69.9, 590.0 69.9 C 595.0 69.9, 595.0 60.0, 600.0 60.0 C 605.0 60.0, 605.0 75.3, 610.0 75.3 C 615.0 75.3, 615.0 75.3, 620.0 75.3 C 625.0 75.3, 625.0 0.0, 630.0 0.0 C 635.0 0.0, 635.0 23.7, 640.0 23.7 C 645.0 23.7, 645.0 75.7, 650.0 75.7 C 655.0 75.7, 655.0 66.5, 660.0 66.5 C 665.0 66.5, 665.0 71.6, 670.0 71.6 C 675.0 71.6, 675.0 71.1, 680.0 71.1 C 685.0 71.1, 685.0 71.1, 690.0 71.1 C 695.0 71.1, 695.0 70.0, 700.0 70.0 C 705.0 70.0, 705.0 62.2, 710.0 62.2 C 715.0 62.2, 715.0 53.7, 720.0 53.7 C 725.0 53.7, 725.0 68.3, 730.0 68.3 C 735.0 68.3, 735.0 52.6, 740.0 52.6 C 745.0 52.6, 745.0 1.4, 750.0 1.4 C 755.0 1.4, 755.0 65.8, 760.0 65.8 C 765.0 65.8, 765.0 72.1, 770.0 72.1 C 775.0 72.1, 775.0 72.5, 780.0 72.5 C 785.0 72.5, 785.0 66.4, 790.0 66.4 C 795.0 66.4, 795.0 59.0, 800.0 59.0 C 805.0 59.0, 805.0 66.5, 810.0 66.5 C 815.0 66.5, 815.0 70.1, 820.0 70.1 C 825.0 70.1, 825.0 64.4, 830.0 64.4 C 835.0 64.4, 835.0 72.1, 840.0 72.1 C 845.0 72.1, 845.0 74.4, 850.0 74.4 C 855.0 74.4, 855.0 73.8, 860.0 73.8 C 865.0 73.8, 865.0 73.2, 870.0 73.2 C 875.0 73.2, 875.0 72.8, 880.0 72.8 C 885.0 72.8, 885.0 73.4, 890.0 73.4 C 895.0 73.4, 895.0 73.3, 900.0 73.3 C 905.0 73.3, 905.0 71.9, 910.0 71.9 C 915.0 71.9, 915.0 68.2, 920.0 68.2 C 925.0 68.2, 925.0 70.7, 930.0 70.7 C 935.0 70.7, 935.0 77.9, 940.0 77.9 C 945.0 77.9, 945.0 78.8, 950.0 78.8 C 955.0 78.8, 955.0 79.3, 960.0 79.3 C 965.0 79.3, 965.0 79.4, 970.0 79.4 C 975.0 79.4, 975.0 79.3, 980.0 79.3 C 985.0 79.3, 985.0 78.6, 990.0 78.6 C 995.0 78.6, 995.0 80.0, 1000.0 80.0 L 1000 100 Z'
        return re
      }
    },
    mounted () {
    }
  }
</script>

<style lang="less" scoped>
  @import url("index.less");
</style>
